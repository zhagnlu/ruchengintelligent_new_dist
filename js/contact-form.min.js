class ContactFormHandler{constructor(e={}){this.formSelector=e.formSelector||".contact-form",this.submitMethod=e.submitMethod||"email",this.apiEndpoint=e.apiEndpoint||"/api/contact",this.emailServiceUrl=e.emailServiceUrl||null,this.onSuccess=e.onSuccess||this.defaultSuccessHandler,this.onError=e.onError||this.defaultErrorHandler,this.init()}init(){const e=document.querySelector(this.formSelector);e&&(e.removeAttribute("onsubmit"),e.addEventListener("submit",e=>this.handleSubmit(e)))}async handleSubmit(e){e.preventDefault();const t=e.target,a=t.querySelector('button[type="submit"]'),o=this.getFormData(t);if(!this.validateForm(o))return void this.showMessage("请填写所有必填项","error");a.disabled=!0;const s=a.textContent;a.textContent="Sending...";try{let e;switch(this.submitMethod){case"email":e=await this.submitViaEmail(o);break;case"api":e=await this.submitViaAPI(o);break;case"googleforms":e=await this.submitViaGoogleForms(o);break;case"localStorage":e=await this.submitViaLocalStorage(o);break;default:throw new Error("Invalid submit method")}this.onSuccess(e),this.showMessage("消息发送成功！我们会尽快回复您。","success"),t.reset()}catch(e){this.onError(e),this.showMessage("发送失败，请稍后重试或直接联系我们。","error")}finally{a.disabled=!1,a.textContent=s}}getFormData(e){const t=e.querySelectorAll("input, textarea"),a={timestamp:(new Date).toISOString(),ip:null};return t.forEach(e=>{const t=e.name||e.type||"unknown",o=e.value.trim();"email"===e.type?a.email=o:"TEXTAREA"===e.tagName?a.message=o:"text"===e.type?a.name?a[t]=o:a.name=o:a[t]=o}),a}validateForm(e){return!(!e.name||e.name.length<2)&&!(!e.email||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||!e.message||e.message.length<10)}async submitViaEmail(e){if(window.emailjs&&this.emailServiceUrl)return await emailjs.send("YOUR_SERVICE_ID","YOUR_TEMPLATE_ID",{from_name:e.name,from_email:e.email,message:e.message,to_email:"info@ruchengintelligent.com"});const t=await fetch("https://formsubmit.co/ajax/info@ruchengintelligent.com",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({name:e.name,email:e.email,message:e.message,_subject:`New Contact Form Submission from ${e.name}`,_template:"table",_captcha:"false"})});if(!t.ok)throw new Error("Email service failed");return await t.json()}async submitViaAPI(e){const t=await fetch(this.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error(`API error: ${t.status}`);return await t.json()}async submitViaGoogleForms(e){const t=new URLSearchParams({"entry.NAME_FIELD_ID":e.name,"entry.EMAIL_FIELD_ID":e.email,"entry.MESSAGE_FIELD_ID":e.message});return await fetch("https://docs.google.com/forms/d/e/YOUR_FORM_ID/formResponse",{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t}),{success:!0}}async submitViaLocalStorage(e){const t=JSON.parse(localStorage.getItem("contactSubmissions")||"[]");return t.push(e),localStorage.setItem("contactSubmissions",JSON.stringify(t)),{success:!0,data:e}}showMessage(e,t="info"){const a=document.querySelector(".contact-form-message");a&&a.remove();const o=document.createElement("div");o.className=`contact-form-message ${t}`,o.textContent=e;const s={padding:"16px 20px",marginTop:"16px",borderRadius:"8px",fontSize:"15px",fontWeight:"500",textAlign:"center",animation:"slideInUp 0.3s ease",backgroundColor:"success"===t?"#d4edda":"#f8d7da",color:"success"===t?"#155724":"#721c24",border:"success"===t?"1px solid #c3e6cb":"1px solid #f5c6cb"};Object.assign(o.style,s);const n=document.querySelector(this.formSelector);n.parentNode.insertBefore(o,n.nextSibling),setTimeout(()=>{o.style.animation="slideOutDown 0.3s ease",setTimeout(()=>o.remove(),300)},3e3)}defaultSuccessHandler(e){window.gtag&&gtag("event","form_submission",{event_category:"contact",event_label:"contact_form"})}defaultErrorHandler(e){}static getStoredSubmissions(){return JSON.parse(localStorage.getItem("contactSubmissions")||"[]")}static clearStoredSubmissions(){localStorage.removeItem("contactSubmissions")}static exportSubmissionsToCSV(){const e=ContactFormHandler.getStoredSubmissions();if(0===e.length)return;const t=e.map(e=>[e.timestamp,e.name,e.email,e.message.replace(/\n/g," ")]),a=[["Timestamp","Name","Email","Message"].join(","),...t.map(e=>e.map(e=>`"${e}"`).join(","))].join("\n"),o=new Blob([a],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");s.href=URL.createObjectURL(o),s.download=`contact-submissions-${Date.now()}.csv`,s.click()}}if(!document.getElementById("contact-form-animations")){const e=document.createElement("style");e.id="contact-form-animations",e.textContent="\n    @keyframes slideInUp {\n      from {\n        opacity: 0;\n        transform: translateY(20px);\n      }\n      to {\n        opacity: 1;\n        transform: translateY(0);\n      }\n    }\n    @keyframes slideOutDown {\n      from {\n        opacity: 1;\n        transform: translateY(0);\n      }\n      to {\n        opacity: 0;\n        transform: translateY(20px);\n      }\n    }\n  ",document.head.appendChild(e)}"undefined"!=typeof module&&module.exports?module.exports=ContactFormHandler:window.ContactFormHandler=ContactFormHandler;