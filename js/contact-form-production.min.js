class ContactFormProductionHandler{constructor(e={}){this.formSelector=e.formSelector||".contact-form",this.emailAddress=e.emailAddress||"info@ruchengintelligent.com",this.allowedDomains=e.allowedDomains||["ruchengintelligent.com","www.ruchengintelligent.com","localhost"],this.enableRateLimit=!1!==e.enableRateLimit,this.rateLimitMinutes=e.rateLimitMinutes||5,this.onSuccess=e.onSuccess||this.defaultSuccessHandler,this.onError=e.onError||this.defaultErrorHandler,this.init()}init(){if(!this.isDomainAllowed())return;const e=document.querySelector(this.formSelector);e&&(e.removeAttribute("onsubmit"),e.addEventListener("submit",e=>this.handleSubmit(e)))}isDomainAllowed(){const e=window.location.hostname;return this.allowedDomains.some(t=>e===t||e.endsWith("."+t))}isRateLimited(){if(!this.enableRateLimit)return!1;const e=localStorage.getItem("contactForm_lastSubmit");if(!e)return!1;const t=Date.now()-parseInt(e),n=60*this.rateLimitMinutes*1e3;return t<n&&Math.ceil((n-t)/6e4)}recordSubmitTime(){localStorage.setItem("contactForm_lastSubmit",Date.now().toString())}async handleSubmit(e){e.preventDefault();const t=e.target,n=t.querySelector('button[type="submit"]'),o=this.isRateLimited();if(o)return void this.showMessage(`请等待 ${o} 分钟后再次提交`,"warning");const r=this.getFormData(t);if(!this.validateForm(r))return void this.showMessage("请填写所有必填项","error");n.disabled=!0;const a=n.textContent;n.textContent="Sending...";try{const e=await this.submitToFormSubmit(r);this.recordSubmitTime(),this.onSuccess(e),this.showMessage("消息发送成功！我们会尽快回复您。","success"),t.reset()}catch(e){this.onError(e),this.showMessage("发送失败，请稍后重试或直接联系我们。","error")}finally{n.disabled=!1,n.textContent=a}}getFormData(e){return{name:e.querySelector('[name="name"]')?.value.trim()||"",email:e.querySelector('[name="email"]')?.value.trim()||"",message:e.querySelector('[name="message"]')?.value.trim()||"",timestamp:(new Date).toISOString(),source:window.location.href,userAgent:navigator.userAgent}}validateForm(e){if(!e.name||e.name.length<2)return!1;if(!e.email||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email))return!1;if(!e.message||e.message.length<10)return!1;const t=e.name+e.email+e.message;return![/<script/i,/javascript:/i,/on\w+\s*=/i,/<iframe/i].some(e=>e.test(t))}async submitToFormSubmit(e){const t=await fetch(`https://formsubmit.co/ajax/${this.emailAddress}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({name:e.name,email:e.email,message:e.message,_subject:`新联系表单提交 - ${e.name}`,_template:"table",_captcha:"false",_autoresponse:`您好 ${e.name}，\n\n感谢您联系如程科技！我们已收到您的消息，会在24小时内回复。\n\n如程科技\nRucheng Intelligent`,_replyto:e.email,_source:e.source,_timestamp:e.timestamp,_honey:""})});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);return await t.json()}showMessage(e,t="info"){const n=document.querySelector(".contact-form-message");n&&n.remove();const o=document.createElement("div");o.className=`contact-form-message ${t}`,o.textContent=e,Object.assign(o.style,{padding:"16px 20px",marginTop:"16px",borderRadius:"8px",fontSize:"15px",fontWeight:"500",textAlign:"center",animation:"slideInUp 0.3s ease"},{success:{backgroundColor:"#d4edda",color:"#155724",border:"1px solid #c3e6cb"},error:{backgroundColor:"#f8d7da",color:"#721c24",border:"1px solid #f5c6cb"},warning:{backgroundColor:"#fff3cd",color:"#856404",border:"1px solid #ffeeba"},info:{backgroundColor:"#d1ecf1",color:"#0c5460",border:"1px solid #bee5eb"}}[t]);const r=document.querySelector(this.formSelector);r.parentNode.insertBefore(o,r.nextSibling),setTimeout(()=>{o.style.animation="slideOutDown 0.3s ease",setTimeout(()=>o.remove(),300)},3e3)}defaultSuccessHandler(e){window.gtag&&gtag("event","form_submission",{event_category:"contact",event_label:"contact_form",value:1}),window.fbq&&fbq("track","Contact")}defaultErrorHandler(e){}}if(!document.getElementById("contact-form-animations")){const e=document.createElement("style");e.id="contact-form-animations",e.textContent="\n    @keyframes slideInUp {\n      from {\n        opacity: 0;\n        transform: translateY(20px);\n      }\n      to {\n        opacity: 1;\n        transform: translateY(0);\n      }\n    }\n    @keyframes slideOutDown {\n      from {\n        opacity: 1;\n        transform: translateY(0);\n      }\n      to {\n        opacity: 0;\n        transform: translateY(20px);\n      }\n    }\n  ",document.head.appendChild(e)}"undefined"!=typeof module&&module.exports?module.exports=ContactFormProductionHandler:window.ContactFormProductionHandler=ContactFormProductionHandler;