class TranslatorV2{constructor(n={}){this.currentLang=n.defaultLang||"en",this.translateElements=n.elements||"[data-translate]",this.languageSelector=n.selector||".language-selector",this.batchSize=n.batchSize||5,this.translationDelay=n.delay||50,this.cache=new Map,this.isTranslating=!1,this.translationProgress=0,this.totalElements=0,this.abortController=null,this.translationsBase="/translations",this.globalTranslations={},this.pageTranslations={},this.currentPageType=this.detectPageType(),this.currentPageId=this.getPageId(),this.init()}detectPageType(){const n=window.location.pathname;return n.includes("/blogs/")?"blog":n.includes("/product/")?"product":"global"}getPageId(){const n=window.location.pathname;if("blog"===this.currentPageType){const t=n.match(/\/blogs\/([^/]+)\.html/);return t?t[1]:null}if("product"===this.currentPageType){const t=n.match(/\/product\/(.+)\.html/);return t?t[1]:null}return null}async init(){this.createLanguageSelector(),this.bindEvents(),this.createProgressIndicator(),await this.loadTranslations(),this.loadSavedLanguage()}async loadTranslations(){const n=performance.now();try{const t=[this.loadGlobalTranslations()];"global"!==this.currentPageType&&this.currentPageId&&t.push(this.loadPageTranslations()),await Promise.all(t),Math.round(performance.now()-n)}catch(n){}}async loadGlobalTranslations(){const n=["zh","es","fr","de","ja","ar","ru"].map(n=>this.loadGlobalForLang(n));await Promise.all(n)}async loadGlobalForLang(n){try{const t=new AbortController,a=setTimeout(()=>t.abort(),1e4),e=await fetch(`${this.translationsBase}/global/common.${n}.json`,{signal:t.signal});if(clearTimeout(a),e.ok){this.globalTranslations[n]||(this.globalTranslations[n]={});const t=await e.json();Object.assign(this.globalTranslations[n],t)}}catch(n){n.name}}async loadPageTranslations(){const n=["zh","es","fr","de","ja","ar","ru"].map(n=>this.loadPageForLang(n));await Promise.all(n)}async loadPageForLang(n){try{let t;"blog"===this.currentPageType?t=`${this.translationsBase}/blogs/${this.currentPageId}.${n}.json`:"product"===this.currentPageType&&(t=`${this.translationsBase}/product/${this.currentPageId}.${n}.json`);const a=new AbortController,e=setTimeout(()=>a.abort(),1e4),s=await fetch(t,{signal:a.signal});if(clearTimeout(e),s.ok){this.pageTranslations[n]||(this.pageTranslations[n]={});const t=await s.json();Object.assign(this.pageTranslations[n],t)}}catch(n){n.name}}async changeLanguage(n){if(n!==this.currentLang){this.isTranslating&&this.abortController&&(this.abortController.abort(),this.clearTranslatingStatus()),this.abortController=new AbortController,this.isTranslating=!0,this.updateTranslationIndicator(!0),this.showProgressBar();try{await this.translatePageProgressively(n),this.currentLang=n,this.updateLanguageSelector(),this.saveLanguage(),this.showStatus(`Translated to ${this.getLanguageName(n)}`,2e3)}catch(n){"AbortError"===n.name||this.showStatus("Translation failed",3e3)}finally{this.isTranslating=!1,this.updateTranslationIndicator(!1),this.hideProgressBar(),this.abortController=null}}}async translatePageProgressively(n){const t=document.querySelectorAll(this.translateElements);if(this.totalElements=t.length,this.translationProgress=0,0===this.totalElements)return;const a=this.createBatches(Array.from(t),this.batchSize);for(let t=0;t<a.length;t++){if(this.abortController&&this.abortController.signal.aborted)throw new DOMException("Translation aborted","AbortError");const e=a[t],s=e.map(t=>this.translateElement(t,n));await Promise.all(s),this.translationProgress+=e.length,this.updateProgressBar(),t<a.length-1&&await this.delay(this.translationDelay)}}createBatches(n,t){const a=[];for(let e=0;e<n.length;e+=t)a.push(n.slice(e,e+t));return a}async translateElement(n,t){n.dataset.originalText||(n.dataset.originalText=n.textContent.trim());const a=n.dataset.originalText;if(a){if("en"===t)return n.textContent=a,void n.classList.remove("element-translating","element-translated");if(!this.abortController||!this.abortController.signal.aborted){n.classList.add("element-translating");try{const e=await this.getTranslation(a,t);if(this.abortController&&this.abortController.signal.aborted)return void n.classList.remove("element-translating");e&&e!==a?(n.textContent=e,n.classList.remove("element-translating"),n.classList.add("element-translated")):n.classList.remove("element-translating")}catch(t){t.name,n.classList.remove("element-translating")}}}}async getTranslation(n,t){const a=`${n}_${t}`;if(this.cache.has(a))return this.cache.get(a);const e=n.replace(/\s+/g," ").trim();if(this.pageTranslations[t]){const s=this.pageTranslations[t][n]||this.pageTranslations[t][e];if(s)return this.cache.set(a,s),s}if(this.globalTranslations[t]){const s=this.globalTranslations[t][n]||this.globalTranslations[t][e];if(s)return this.cache.set(a,s),s}return n}createLanguageSelector(){const n=document.querySelector(this.languageSelector);n&&n.remove();const t=document.createElement("div");t.className="language-selector",t.innerHTML=`\n      <div class="language-dropdown">\n        <button class="language-toggle" aria-label="Select Language">\n          <span class="current-lang">${this.getLanguageName(this.currentLang)}</span>\n          <span class="lang-arrow">â–¼</span>\n          <span class="translation-indicator" style="display: none;">\n            <span class="spinner"></span>\n          </span>\n        </button>\n        <div class="language-menu">\n          <button class="lang-option" data-lang="en">\n            <span class="lang-flag">ğŸ‡ºğŸ‡¸</span>\n            <span class="lang-name">English</span>\n          </button>\n          <button class="lang-option" data-lang="zh">\n            <span class="lang-flag">ğŸ‡¨ğŸ‡³</span>\n            <span class="lang-name">ä¸­æ–‡</span>\n          </button>\n          <button class="lang-option" data-lang="es">\n            <span class="lang-flag">ğŸ‡ªğŸ‡¸</span>\n            <span class="lang-name">EspaÃ±ol</span>\n          </button>\n          <button class="lang-option" data-lang="fr">\n            <span class="lang-flag">ğŸ‡«ğŸ‡·</span>\n            <span class="lang-name">FranÃ§ais</span>\n          </button>\n          <button class="lang-option" data-lang="de">\n            <span class="lang-flag">ğŸ‡©ğŸ‡ª</span>\n            <span class="lang-name">Deutsch</span>\n          </button>\n          <button class="lang-option" data-lang="ja">\n            <span class="lang-flag">ğŸ‡¯ğŸ‡µ</span>\n            <span class="lang-name">æ—¥æœ¬èª</span>\n          </button>\n          <button class="lang-option" data-lang="ar">\n            <span class="lang-flag">ğŸ‡¸ğŸ‡¦</span>\n            <span class="lang-name">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>\n          </button>\n          <button class="lang-option" data-lang="ru">\n            <span class="lang-flag">ğŸ‡·ğŸ‡º</span>\n            <span class="lang-name">Ğ ÑƒÑÑĞºĞ¸Ğ¹</span>\n          </button>\n        </div>\n      </div>\n    `,this.addStyles();const a=document.querySelector(".main-header .nav-menu");if(a){const n=a.querySelector('a[href="#"]');n&&n.parentNode.replaceChild(t,n)}}createProgressIndicator(){const n=document.createElement("div");n.id="translation-progress",n.className="translation-progress",n.style.display="none",document.body.appendChild(n)}addStyles(){if(document.getElementById("dynamic-translator-styles"))return;const n=document.createElement("style");n.id="dynamic-translator-styles",n.textContent="\n      .language-selector {\n        position: relative;\n        display: inline-block;\n      }\n\n      .language-dropdown {\n        position: relative;\n      }\n\n      .language-toggle {\n        background: none;\n        border: none;\n        color: #2E4A78;\n        font-size: 20px;\n        font-weight: 600;\n        letter-spacing: 0.5px;\n        font-family: 'Inter', Arial, sans-serif;\n        cursor: pointer;\n        padding: 0 15px;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        border-radius: 6px;\n        transition: color 0.2s, text-shadow 0.2s;\n        height: 100%;\n      }\n\n      .language-toggle:hover {\n        color: #2563eb;\n        text-shadow: 0 2px 8px rgba(59, 130, 246, 0.20);\n      }\n\n      .current-lang {\n        font-weight: 600;\n        color: inherit;\n      }\n\n      .lang-arrow {\n        font-size: 0.8em;\n        transition: transform 0.3s ease;\n      }\n\n      .language-dropdown.active .lang-arrow {\n        transform: rotate(180deg);\n      }\n\n      .translation-indicator {\n        display: flex;\n        align-items: center;\n      }\n\n      .spinner {\n        width: 12px;\n        height: 12px;\n        border: 2px solid transparent;\n        border-top: 2px solid #2E4A78;\n        border-radius: 50%;\n        animation: spin 1s linear infinite;\n      }\n\n      @keyframes spin {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n      }\n\n      .language-menu {\n        position: absolute;\n        top: 100%;\n        right: 0;\n        background: white;\n        border: 1px solid #e1e5e9;\n        border-radius: 8px;\n        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);\n        min-width: 150px;\n        z-index: 1000;\n        opacity: 0;\n        visibility: hidden;\n        transform: translateY(-10px);\n        transition: all 0.3s ease;\n      }\n\n      .language-dropdown.active .language-menu {\n        opacity: 1;\n        visibility: visible;\n        transform: translateY(0);\n      }\n\n      .lang-option {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        padding: 12px 16px;\n        border: none;\n        background: none;\n        width: 100%;\n        text-align: left;\n        cursor: pointer;\n        transition: background 0.3s ease;\n        color: #333;\n        font-family: 'Inter', Arial, sans-serif;\n        font-size: 16px;\n        font-weight: 500;\n      }\n\n      .lang-option:hover {\n        background: #f8f9fa;\n      }\n\n      .lang-option.active {\n        background: #0074c2;\n        color: white;\n      }\n\n      .lang-flag {\n        font-size: 1.2em;\n      }\n\n      .lang-name {\n        font-weight: 500;\n        font-family: 'Inter', Arial, sans-serif;\n      }\n\n      .translation-progress {\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        height: 4px;\n        background: #e5e7eb;\n        z-index: 10000;\n        overflow: hidden;\n      }\n\n      .translation-progress::after {\n        content: '';\n        position: absolute;\n        top: 0;\n        left: 0;\n        height: 100%;\n        background: linear-gradient(90deg, #10b981, #3b82f6);\n        width: 0%;\n        transition: width 0.3s ease;\n      }\n\n      .translation-progress.active::after {\n        width: var(--progress, 0%);\n      }\n\n      .translation-status {\n        position: fixed;\n        bottom: 20px;\n        right: 20px;\n        background: #10b981;\n        color: white;\n        padding: 12px 16px;\n        border-radius: 8px;\n        font-size: 0.9rem;\n        z-index: 10000;\n        opacity: 0;\n        transform: translateY(20px);\n        transition: all 0.3s ease;\n        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);\n      }\n\n      .translation-status.show {\n        opacity: 1;\n        transform: translateY(0);\n      }\n\n      .element-translating {\n        position: relative;\n        opacity: 0.7;\n      }\n\n      .element-translated {\n        animation: fadeInTranslate 0.5s ease;\n      }\n\n      @keyframes fadeInTranslate {\n        from {\n          opacity: 0.7;\n          transform: translateY(5px);\n        }\n        to {\n          opacity: 1;\n          transform: translateY(0);\n        }\n      }\n\n      @media (max-width: 768px) {\n        .language-menu {\n          right: auto;\n          left: 0;\n          min-width: 120px;\n        }\n\n        .language-toggle {\n          font-size: 16px !important;\n          font-weight: 500 !important;\n          padding: 12px 16px !important;\n          margin: 0 !important;\n          color: #2E4A78 !important;\n          background: #fff !important;\n          border-bottom: 1px solid #eee !important;\n          height: auto !important;\n          width: 100% !important;\n          justify-content: space-between !important;\n        }\n\n        .language-toggle:hover {\n          background: #eff6ff !important;\n          color: #2E4A78 !important;\n        }\n\n        .lang-option {\n          font-size: 14px;\n          padding: 10px 12px;\n        }\n\n        .translation-status {\n          bottom: 10px;\n          right: 10px;\n          left: 10px;\n        }\n      }\n    ",document.head.appendChild(n)}bindEvents(){document.addEventListener("click",n=>{const t=n.target.closest(".language-toggle"),a=n.target.closest(".lang-option"),e=n.target.closest(".language-dropdown");if(t)t.closest(".language-dropdown").classList.toggle("active");else if(a){const n=a.dataset.lang;if(this.changeLanguage(n),a.closest(".language-dropdown").classList.remove("active"),window.innerWidth<=768){const n=document.querySelector(".nav-menu"),t=document.querySelector(".menu-toggle"),a=document.querySelector(".menu-overlay");n&&n.classList.remove("active"),a&&a.classList.remove("active"),t&&(t.innerHTML="&#9776;")}}else e||document.querySelectorAll(".language-dropdown").forEach(n=>n.classList.remove("active"))}),document.addEventListener("keydown",n=>{"Escape"===n.key&&document.querySelectorAll(".language-dropdown").forEach(n=>n.classList.remove("active"))})}clearTranslatingStatus(){document.querySelectorAll(".element-translating").forEach(n=>{n.classList.remove("element-translating")})}updateTranslationIndicator(n){const t=document.querySelector(".translation-indicator");t&&(t.style.display=n?"flex":"none")}showProgressBar(){const n=document.getElementById("translation-progress");n&&(n.style.display="block",n.classList.add("active"))}hideProgressBar(){const n=document.getElementById("translation-progress");n&&(n.classList.remove("active"),setTimeout(()=>n.style.display="none",300))}updateProgressBar(){const n=this.translationProgress/this.totalElements*100,t=document.getElementById("translation-progress");t&&t.style.setProperty("--progress",`${n}%`)}showStatus(n,t=3e3){let a=document.querySelector(".translation-status");a||(a=document.createElement("div"),a.className="translation-status",document.body.appendChild(a)),a.textContent=n,a.classList.add("show"),setTimeout(()=>{a.classList.remove("show")},t)}delay(n){return new Promise(t=>setTimeout(t,n))}getLanguageName(n){return{en:"English",zh:"ä¸­æ–‡",es:"EspaÃ±ol",fr:"FranÃ§ais",de:"Deutsch",ja:"æ—¥æœ¬èª",ar:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",ru:"Ğ ÑƒÑÑĞºĞ¸Ğ¹"}[n]||n}updateLanguageSelector(){const n=document.querySelector(".current-lang");n&&(n.textContent=this.getLanguageName(this.currentLang)),document.querySelectorAll(".lang-option").forEach(n=>{n.classList.toggle("active",n.dataset.lang===this.currentLang)})}saveLanguage(){localStorage.setItem("preferred-language",this.currentLang)}loadSavedLanguage(){const n=localStorage.getItem("preferred-language");n&&n!==this.currentLang&&this.changeLanguage(n)}getCurrentLanguage(){return this.currentLang}clearCache(){this.cache.clear()}getStats(){return{pageType:this.currentPageType,pageId:this.currentPageId,cacheSize:this.cache.size,globalTranslations:Object.keys(this.globalTranslations).map(n=>({lang:n,count:Object.keys(this.globalTranslations[n]||{}).length})),pageTranslations:Object.keys(this.pageTranslations).map(n=>({lang:n,count:Object.keys(this.pageTranslations[n]||{}).length}))}}printStats(){const n=this.getStats();return n.globalTranslations.forEach(({lang:n,count:t})=>{}),n.pageTranslations.length>0&&n.pageTranslations.forEach(({lang:n,count:t})=>{}),n}}"undefined"!=typeof module&&module.exports?module.exports=TranslatorV2:window.TranslatorV2=TranslatorV2;